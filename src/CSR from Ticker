import requests
import pandas as pd
from datetime import datetime
import json

# OpenFIGI API key (make sure this key is valid)
API_KEY = "AIzaSyDH_BittfLYkGkRj44kVT4WYRZcDwqdEUE"  # Replace with your valid API Key
SEARCH_ENGINE_ID= "4082aa3eec5e64a62" 
current_year= datetime.now().year
previous_year= current_year - 1
search_query = f"{user_input} CSR report filetype:pdf"
url = 'https://www.googleapis.com/customsearch/v1'
params= {
    'q':search_query,
    'key':API_KEY,
    'cx':SEARCH_ENGINE_ID
}
response = requests.get(url,params=params)
results = response.json()

filtered_links=[]

if 'items' in results:
    for item in results['items']:
        if 'pdf' in item['link'].lower(): #to check for pdf
            title = item.get('title', '').lower()
            if str(current_year) in title or str(previous_year) in title: # to check for the latest issue of the reports
                filtered_links.append(item['link'])
            
            
        
    print(results['items'][0]['link'])
